---
title: "First Draft of Advanced Portfolio Management Project"
output: html_notebook
author: "Kaiyi Li"
---

# Preparation Work.
## Load data.
Most function we use would be stored in the "helper.r". Set the global variables here. 
```{r}
source("helper.R")
tickers <- c("SPY","TLT","HYG","LQD","GLD","BNO","VIXY")
start_date <- "2011-03-11"
num_of_tickers <- length(tickers)
```
At this point, we are trying to build a portfolio that can diversify the risk using multiple asset classes.
First would be collecting data using quantmod from Yahoo Finance. 
```{r}
result <- collect_data(tickers,start_date)
close_data <- result$close_data
return_data <- result$return_data
```
## Plot all time series.
The adjusted price path.
```{r}
adj_close_plot <- plot_ad_close(close_data,to_local = TRUE)
adj_close_plot
```
The return series
```{r}
return_plot <- plot_return_paths(return_data,to_local = F)
return_plot
```
Plot the distribution for all returns.
```{r}
lapply(1:6, plot_return_distributions,return_data = return_data,to_local = F)
```

## Analyze Each Stock's Performance
```{r}
source("helper.R")
library(PerformanceAnalytics)
chart.Correlation(return_data)
```
## Daily VaR
```{r}
# lapply(1:6, chart.BarVaR)
sapply(1:7,Calculate_VaR,return_data=return_data,method = "Gaussian")
```
## Relative Performance to SPY
```{r}
for (i in 2:num_of_tickers) {
  print(chart.RelativePerformance(Ra = return_data[,i],Rb = return_data[,1]))
}
```

## Drawdown
```{r}
# source("helper.R")
# sapply(1:num_of_tickers, draw_downs,return_data = return_data)
for (i in 1:num_of_tickers) {
  print(chart.Drawdown(return_data[,i]))
}
```
## Rolling Correlations
```{r}
for (i in 2:num_of_tickers) {
 print(chart.RollingCorrelation(Ra = return_data[,i],Rb = return_data[,1]) )
}
```
## Rolling Performance
```{r}
for (i in 1:num_of_tickers) {
  print(chart.RollingPerformance(R = return_data[,i],width = 256))
}
```

## Risk-Return
```{r}
chart.RiskReturnScatter(R = return_data,Rf = 0.0073/252)
```

## Rolling Regression
```{r}
# chart.RollingRegression(Ra = return_data[,1],Rb = return_data[,2])
for (i in 2:num_of_tickers) {
  print(chart.RollingRegression(Ra = return_data[,i],Rb = return_data[,1]),attribute = "Beta")
}
```

```{r}
for (i in 2:num_of_tickers) {
  print(chart.CaptureRatios(Ra=return_data[,i],Rb = return_data[,1]))
}
```













